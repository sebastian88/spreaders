var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var c=0;return function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+c++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var a=0;return $jscomp.iteratorPrototype(function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.makeIterator=function(c){$jscomp.initSymbolIterator();var a=c[Symbol.iterator];return a?a.call(c):$jscomp.arrayIterator(c)};
$jscomp.polyfill=function(c,a,b,d){if(a){b=$jscomp.global;c=c.split(".");for(d=0;d<c.length-1;d++){var e=c[d];e in b||(b[e]={});b=b[e]}c=c[c.length-1];d=b[c];a=a(d);a!=d&&null!=a&&$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:a})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(c){function a(){this.batch_=null}function b(a){return a instanceof e?a:new e(function(b,c){b(a)})}if(c&&!$jscomp.FORCE_POLYFILL_PROMISE)return c;a.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};a.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var d=$jscomp.global.setTimeout;a.prototype.asyncExecuteFunction=function(a){d(a,
0)};a.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};a.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(h){b.reject(h)}};e.prototype.createResolveAndReject_=
function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(h){this.reject_(h);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var f=new a;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(l){c.reject(l)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(p){f(p)}}:b}var d,f,g=new e(function(a,
b){d=a;f=b});this.callWhenSettled_(c(a,d),c(b,f));return g};e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(function(){f.asyncExecute(c)})};e.resolve=b;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(c,
d){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())b(f.value).callWhenSettled_(c,d)})};e.all=function(a){var c=$jscomp.makeIterator(a),d=c.next();return d.done?b([]):new e(function(a,e){function f(b){return function(c){g[b]=c;k--;0==k&&a(g)}}var g=[],k=0;do g.push(void 0),k++,b(d.value).callWhenSettled_(f(g.length-1),e),d=c.next();while(!d.done)})};return e},"es6","es3");
$jscomp.executeAsyncGenerator=function(c){function a(a){return c.next(a)}function b(a){return c.throw(a)}return new Promise(function(d,e){function f(c){c.done?d(c.value):Promise.resolve(c.value).then(a,b).then(f,e)}f(c.next())})};$jscomp.polyfill("Object.is",function(c){return c?c:function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(c){return c?c:function(a,b){var c=this;c instanceof String&&(c=String(c));var e=c.length;for(b=b||0;b<e;b++)if(c[b]==a||Object.is(c[b],a))return!0;return!1}},"es7","es3");
$jscomp.checkStringArgs=function(c,a,b){if(null==c)throw new TypeError("The 'this' value for String.prototype."+b+" must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+b+" must not be a regular expression");return c+""};$jscomp.polyfill("String.prototype.includes",function(c){return c?c:function(a,b){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,b||0)}},"es6","es3");
spreaders={pages:{},storage:{},observer:{},model:{},view:{},sync:{}};spreaders.model.group=function(){return function(c){this.id;this.externalId="";this.name=c;this.isSyncNeeded=this.isDeleted=0}}();spreaders.model.person=function(){return function(c,a,b){this.id;this.externalId;c?this.groupId=c.externalId:this.groupId;this.name=a;this.colour=b;this.isSyncNeeded=this.isDeleted=0}}();spreaders.model.personTotal=function(){return function(c){this.person=c;this.total=0}}();spreaders.model.transaction=function(){return function(c,a,b,d,e){this.id;this.externalId;c?this.groupId=c.externalId:this.groupId;this.payees=b?b:[];this.payer=a;this.amount=d;this.description=e;this.isSyncNeeded=this.isDeleted=0}}();spreaders.view.personFormList=function(){var c=function(a,b,c,e,f,g){this.currentGroup=a;this.radioContainer=b;this.storage=c;this.inputs=[];this.inputType=e;this.inputName=f;this.callback=g;this.addPersonInput={};this.addButton={}};c.prototype.createRadios=function(){var a=this;this.storage.getPeopleForGroup(this.currentGroup.externalId).then(function(b){a.createRadiosCallback(b)});this.createErrorElement()};c.prototype.createRadiosCallback=function(a){for(var b=0;b<a.length;b++)this.createRadio(a[b]);
this.callback()};c.prototype.createRadio=function(a){label=document.createElement("label");this.radioContainer.appendChild(label);var b=document.createElement("input");b.setAttribute("type",this.inputType);b.setAttribute("name",this.inputName);b.setAttribute("value",this.getPersonId(a));label.appendChild(b);div=document.createElement("div");div.className="box";label.appendChild(div);span=document.createElement("span");span.innerHTML=a.name;div.appendChild(span);this.inputs[this.inputs.length]=b};
c.prototype.getPersonId=function(a){return a.externalId?a.externalId:a.id};c.prototype.createErrorElement=function(){this.errorElement=document.createElement("div");this.errorElement.className="error error_"+this.inputName;this.errorElement.innerHTML="This field is required";this.errorElement.style.display="none";this.radioContainer.appendChild(this.errorElement)};c.prototype.displayError=function(){this.isValid()||(this.errorElement.style.display="block")};c.prototype.isValid=function(){return 0===
this.getValues().length?!1:!0};c.prototype.getValues=function(){for(var a=[],b=0;b<this.inputs.length;b++)this.inputs[b].checked&&a.push(this.getId(this.inputs[b].value));return a};c.prototype.getId=function(a){return String(a).match(/[a-z]/i)?a:parseInt(a)};return c}();spreaders.view.addPerson=function(){var c=function(a,b,c,e){this.currentGroup=a;this.addPersonContainer=b;this.storage=c;this.observer=e;this.colours="#f3a683 #f7d794 #778beb #e77f67 #cf6a87 #e66767 #63cdda #f8a5c2 #786fa6 #596275".split(" ");this.createAddPersonInput()};c.prototype.createAddPersonInput=function(){this.addPersonInput=document.createElement("input");this.addPersonInput.setAttribute("type","text");this.addPersonInput.setAttribute("name","addPerson");this.addPersonContainer.appendChild(this.addPersonInput);
this.addButton=document.createElement("button");this.addButton.innerHTML="add";this.addButton.setAttribute("type","button");this.addPersonContainer.appendChild(this.addButton);this.addPersonInput.addEventListener("keydown",this.processAddPersonClickEventKeyDown.bind(this));this.addButton.addEventListener("click",this.processAddPersonClickEvent.bind(this))};c.prototype.processAddPersonClickEventKeyDown=function(){13==event.keyCode&&(event.preventDefault(),this.processAddPersonClickEvent())};c.prototype.processAddPersonClickEvent=
function(){var a=this;if(this.addPersonInput.value){var b=new spreaders.model.person(this.currentGroup,this.addPersonInput.value,this.getColour());b.createdOn=this.storage.getUtcUnixTimeStamp();b.updatedOn=this.storage.getUtcUnixTimeStamp();this.storage.addPerson(b).then(function(b){a.processAddPersonClickEventCallback(b)});this.addPersonInput.value=""}};c.prototype.processAddPersonClickEventCallback=function(a){this.observer.fire("personCreated",a)};c.prototype.getColour=function(){return this.colours[Math.floor(Math.random()*
this.colours.length)]};return c}();spreaders.view.editablePerson=function(){var c=function(a,b,c,e,f,g){this.person=a;this.container=b;this.storage=c;this.observer=e;this.urlService=f;this.pageContext=g;this.createDiv();this.populateDiv();this.addButtons()};c.prototype.createDiv=function(){this.div=document.createElement("div");this.div.className="person";this.container.appendChild(this.div)};c.prototype.populateDiv=function(){this.ul=document.createElement("ul");this.ul.className="personDetails";this.div.appendChild(this.ul);this.createLi(this.person.name,
"name")};c.prototype.createLi=function(a,b){li=document.createElement("li");li.innerHTML=a;li.className=b;this.ul.appendChild(li)};c.prototype.addButtons=function(){this.deleteButton=this.addButton("delete","delete");this.editButton=this.addButton("edit","edit");this.deleteButtonHander=this.deletePerson.bind(this);this.editButtonHandler=this.editPerson.bind(this);this.addButtonEventListeners()};c.prototype.addButtonEventListeners=function(){this.deleteButton.addEventListener("click",this.deleteButtonHander);
this.editButton.addEventListener("click",this.editButtonHandler)};c.prototype.addButton=function(a,b){var c=document.createElement("button");c.innerHTML=a;c.className=b;c.setAttribute("type","button");this.div.appendChild(c);return c};c.prototype.deletePerson=function(a){var b=this;this.person.isDeleted=1;this.storage.updatePerson(this.person,1).then(function(){b.observer.fire("personDeleted")})};c.prototype.editPerson=function(a){a.stopPropagation();a=this.urlService.getPersonEditPage(this.pageContext.getCurrentGroupId(),
this.person.externalId);window.location.href=a};return c}();spreaders.view.payeeCheckboxes=function(){var c=function(a,b,c,e){spreaders.view.personFormList.call(this,a,b,c,"checkbox","payee",this.PayeeCheckboxesRenderedCallback.bind(this));this.observer=e;this.observer.subscribe("personCreated",this.createRadio,this);this.createRadios()};c.prototype=new spreaders.view.personFormList;c.prototype.PayeeCheckboxesRenderedCallback=function(){this.observer.fire("payeeCheckboxesRendered")};c.prototype.addSelectedValues=function(a){for(var b=0;b<this.inputs.length;b++)(-1<
a.indexOf(parseInt(this.inputs[b].value))||-1<a.indexOf(this.inputs[b].value))&&this.inputs[b].setAttribute("checked","checked")};return c}();spreaders.view.payerRadio=function(){var c=function(a,b,c,e){spreaders.view.personFormList.call(this,a,b,c,"radio","payer",this.payerRadiosRenderedCallback.bind(this));this.observer=e;this.observer.subscribe("personCreated",this.createRadio,this);this.createRadios()};c.prototype=new spreaders.view.personFormList;c.prototype.payerRadiosRenderedCallback=function(){this.observer.fire("payerRadiosRendered")};c.prototype.addSelectedValue=function(a){for(var b=0;b<this.inputs.length;b++)this.inputs[b].value==
a&&this.inputs[b].setAttribute("checked","checked")};return c}();spreaders.view.transaction=function(){var c=function(a,b,c,e,f,g,k){this.transaction=a;this.people=b;this.container=c;this.storage=e;this.pageContext=f;this.urlService=g;this.observer=k;this.createDiv();this.populateDiv();this.addButtons();this.addAccordianEvent()};c.prototype.createDiv=function(){this.div=document.createElement("div");this.div.className="transaction";this.container.appendChild(this.div)};c.prototype.populateDiv=function(){this.ul=document.createElement("ul");this.ul.className="transactionDetails";
this.div.appendChild(this.ul);this.createLi(this.getPerson(this.transaction.payer).name,"payer");this.createLi(this.transaction.description,"description");this.createLi("\u00a3"+this.transaction.amount,"amount");this.createLi(this.getPayeeNamesCsv(),"payees")};c.prototype.createLi=function(a,b,c){li=document.createElement("li");li.innerHTML=a;li.className=b;this.ul.appendChild(li)};c.prototype.getPayeeNamesCsv=function(){for(var a=[],b=0;b<this.transaction.payees.length;b++)a.push(this.getPerson(this.transaction.payees[b]));
return a.map(function(a){firstLetter=document.createElement("span");firstLetter.className="firstLetter";firstLetter.style.backgroundColor=a.colour;firstLetter.innerHTML=a.name.charAt(0);remainingLetters=document.createElement("span");remainingLetters.className="remainingLetters";remainingLetters.innerHTML=a.name.substring(1);firstLetter.appendChild(remainingLetters);return firstLetter.outerHTML}).join("")};c.prototype.getPerson=function(a){for(var b=0;b<this.people.length;b++)if(this.people[b].id===
a||this.people[b].externalId===a)return this.people[b]};c.prototype.addButtons=function(){this.deleteButton=this.addButton("delete","delete");this.editButton=this.addButton("edit","edit");this.deleteButtonHander=this.deleteTransaction.bind(this);this.editButtonHandler=this.editTransaction.bind(this)};c.prototype.addButton=function(a,b){var c=document.createElement("button");c.innerHTML=a;c.className=b;c.setAttribute("type","button");this.div.appendChild(c);return c};c.prototype.addButtonEventListeners=
function(){this.deleteButton.addEventListener("click",this.deleteButtonHander);this.editButton.addEventListener("click",this.editButtonHandler)};c.prototype.removeButtonEventListeners=function(){this.deleteButton.removeEventListener("click",this.deleteButtonHander);this.editButton.removeEventListener("click",this.editButtonHandler)};c.prototype.addAccordianEvent=function(){this.div.addEventListener("click",this.addAccordianClass.bind(this))};c.prototype.addAccordianClass=function(){"transaction"==
this.div.className?(this.addButtonEventListeners(),this.div.className="transaction active"):(this.removeButtonEventListeners(),this.div.className="transaction")};c.prototype.deleteTransaction=function(a){var b=this;a.stopPropagation();this.transaction.isDeleted=1;this.storage.updateTransaction(this.transaction,1).then(function(){b.deleteTransactionCallback()})};c.prototype.deleteTransactionCallback=function(){this.container.removeChild(this.div);this.observer.fire("deleteTransaction",this.transaction)};
c.prototype.editTransaction=function(a){a.stopPropagation();window.location.href=this.urlService.getTransactionPage(this.pageContext.getCurrentGroupId(),this.transaction.externalId)};return c}();spreaders.pageContext=function(){var c=function(a){this.urlService=a},a=function(a){var b=window.location.pathname.split("/");if(-1!==b.indexOf(a))return index=b.indexOf(a),b[index+1]};c.prototype.getCurrentGroupId=function(){return a(this.urlService.GroupsPathSection).toLowerCase()};c.prototype.getCurrentTransaction=function(){return a(this.urlService.TransactionsPathSection).toLowerCase()};c.prototype.getCurrentPerson=function(){return a(this.urlService.PeoplePathSection).toLowerCase()};return c}();spreaders.urlService=function(){var c=function(){this.forwardSlash="/";this.GroupsPathSection="groups";this.TransactionsPathSection="transactions";this.PeoplePathSection="people"};c.prototype.getGroupPage=function(){return this.forwardSlash+this.GroupsPathSection+this.forwardSlash};c.prototype.getTransactionsPage=function(a){return this.getGroupPage()+a+this.forwardSlash+this.TransactionsPathSection+this.forwardSlash};c.prototype.getTransactionPage=function(a,b){a=this.getTransactionsPage(a);return a=
b?a+(b+this.forwardSlash):a+("add"+this.forwardSlash)};c.prototype.getPeoplePage=function(a){return this.getGroupPage()+a+this.forwardSlash+this.PeoplePathSection+this.forwardSlash};c.prototype.getPersonEditPage=function(a,b){return this.getPeoplePage(a)+b+this.forwardSlash};return c}();spreaders.apiService=function(){var c=function(){this.baseUrl="http://localhost:54321";this.apiPath="api";this.syncEndPoint="sync";this.getGroupEndPoint="getgroup";this.forwardSlash="/";this.syncUrl=this.baseUrl+this.forwardSlash+this.apiPath+this.forwardSlash+this.syncEndPoint;this.getGroupUrl=this.baseUrl+this.forwardSlash+this.apiPath+this.forwardSlash+this.getGroupEndPoint+this.forwardSlash};c.prototype.sync=function(a){var b=this;return new Promise(function(c,e){var d=new XMLHttpRequest;d.onreadystatechange=
function(){d.readyState===XMLHttpRequest.DONE&&(200===d.status?c():e())}.bind(b);d.open("POST",b.syncUrl,!0);d.setRequestHeader("Content-type","application/json");d.send(JSON.stringify(a))})};c.prototype.syncWithFetch=function(a){return fetch(this.syncUrl,{method:"POST",body:JSON.stringify(a),headers:new Headers({"content-type":"application/json"})})};c.prototype.getGroup=function(a,b,c){var d=new XMLHttpRequest;d.onreadystatechange=function(){d.readyState===XMLHttpRequest.DONE&&200===d.status&&b(JSON.parse(d.response),
c)}.bind(this);d.open("GET",this.getGroupUrl+a,!0);d.setRequestHeader("Content-type","application/json");d.send()};c.prototype.getGroupPromise=function(a){var b=this;return new Promise(function(c,e){fetch(b.getGroupUrl+a,{headers:new Headers({"content-type":"application/json"})}).then(function(a){a.json().then(function(a){return c(a)})}).catch(function(a){return e(a)})})};return c}();spreaders.storageIndexedDb=function(){var c=function(){this.db;this.callbacks=[];this.dbSchema={name:"SpreadersDb",version:3,groupsTable:{tableName:"groups",keyPath:"id",autoIncrement:!0,index:["externalId","isDeleted","isSyncNeeded","createdOn","updatedOn"],unique:[!0,!1,!1]},peopleTable:{tableName:"people",keyPath:"id",autoIncrement:!0,index:"externalId groupId isDeleted isSyncNeeded createdOn updatedOn".split(" "),unique:[!0,!1,!1,!1]},transactionsTable:{tableName:"transactions",keyPath:"id",autoIncrement:!0,
index:"externalId groupId isDeleted isSyncNeeded createdOn updatedOn".split(" "),unique:[!0,!1,!1,!1]}};this.localIndexedDb=indexedDB?indexedDB:window.indexedDB};c.prototype.handleError=function(a){reject("Error")};c.prototype.handleSuccess=function(a){this.db=a.target.result;resolve()};c.prototype.connect=function(){var a=this;return new Promise(function(b,c){var d=a.localIndexedDb.open(a.dbSchema.name,a.dbSchema.version);d.onupgradeneeded=function(a){this.createDatabase(a);a.target.transaction.oncomplete=
function(a){b()}}.bind(a);d.onsuccess=function(a){this.db=a.target.result;b()}.bind(a);d.onerror=function(a){this.handleError(a);c("Error")}.bind(a)})};c.prototype.createDatabase=function(a){this.db=this.db=a.target.result;this.createTable(this.db,this.dbSchema.groupsTable);this.createTable(this.db,this.dbSchema.peopleTable);this.createTable(this.db,this.dbSchema.transactionsTable)};c.prototype.createTable=function(a,b){if(!a.objectStoreNames.contains(b.tableName)){a=a.createObjectStore(b.tableName,
{keyPath:b.keyPath,autoIncrement:b.autoIncrement});for(var c in b.index)a.createIndex(b.index[c],b.index[c],{unique:b.unique[c]})}};c.prototype.isSupported=function(){var a=!0;this.localIndexedDb||(a=!1);return a};c.prototype.createReadWriteTransaction=function(a){var b=this.db.transaction(a,"readwrite");return this.getObjectStore(b,a)};c.prototype.createReadTransaction=function(a){var b=this.db.transaction(a,"readonly");return this.getObjectStore(b,a)};c.prototype.getObjectStore=function(a,b){return a.objectStore(b)};
c.prototype.generateUUID=function(){var a=(new Date).getTime();"undefined"!==typeof performance&&"function"===typeof performance.now&&(a+=performance.now());return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;a=Math.floor(a/16);return("x"===b?c:c&3|8).toString(16)})};return c}();spreaders.storage=function(){var c=function(){};c.prototype=new spreaders.storageIndexedDb;c.prototype.handleError=function(a){console.log(a)};c.prototype.getUtcUnixTimeStamp=function(){return Math.floor((new Date).getTime()/1E3)};c.prototype.addEntity=function(a,b){var c=this;return new Promise(function(d,f){a.externalId=c.generateUUID();a.isSyncNeeded=1;var e=c.createReadWriteTransaction(b).add(a);e.onerror=function(a){f(a)};e.onsuccess=function(b){a.id=b.target.result;d(a)}})};c.prototype.getAllOfEntity=
function(a){var b=this;return new Promise(function(c,e){var d=[],g=b.createReadTransaction(a).openCursor();g.onerror=function(a){e(a)};g.onsuccess=function(a){(a=a.target.result)?(a.value.isDeleted||d.push(a.value),a.continue()):c(d)}})};c.prototype.getFromIndexStore=function(a,b,c){var d=this;return new Promise(function(e,g){var f=[],h=d.createReadTransaction(a).index(b).openCursor(c);h.onerror=function(a){g(a)};h.onsuccess=function(a){(a=a.target.result)?(a.value.isDeleted||f.push(a.value),a.continue()):
e(f)}})};c.prototype.getAllFromIndexStore=function(a,b,c){var d=this;return new Promise(function(e,g){var f=[],h=d.createReadTransaction(a).index(b).openCursor(c);h.onerror=function(a){g(a)};h.onsuccess=function(a){(a=a.target.result)?(f.push(a.value),a.continue()):e(f)}})};c.prototype.getOneFromIndexStore=function(a,b,c){var d=this;return new Promise(function(e,g){var f=d.createReadTransaction(a).index(b).openCursor(c);f.onerror=function(a){g(a)};f.onsuccess=function(a){(a=a.target.result)?e(a.value):
e(null)}})};c.prototype.updateEntity=function(a,b,c){var d=this;return new Promise(function(e,g){b.isSyncNeeded=c&&0!==c?1:0;d.createReadWriteTransaction(a).put(b).onsuccess=function(a){e(a.target.result)}})};c.prototype.addOrUpdateEntity=function(a,b,c,e){var d=this;return new Promise(function(f,k){var g=d.createReadTransaction(a).index("externalId").openCursor(b.id);g.onerror=function(a){k(a)};g.onsuccess=function(d){d=d.target.result;var g=null;d&&(g=d.value);e(g,b)?f(!1):(d=c(g,b),this.createReadWriteTransaction(a).put(d).onsuccess=
function(a){f(!0)})}.bind(d)})};c.prototype.addGroup=function(a){return this.addEntity(a,this.dbSchema.groupsTable.tableName)};c.prototype.updateGroup=function(a,b){return this.updateEntity(this.dbSchema.groupsTable.tableName,a,b)};c.prototype.addOrUpdateGroup=function(a,b,c){return this.addOrUpdateEntity(this.dbSchema.groupsTable.tableName,a,b,c)};c.prototype.getAllGroups=function(){return this.getAllOfEntity(this.dbSchema.groupsTable.tableName)};c.prototype.getGroup=function(a){return this.getOneFromIndexStore(this.dbSchema.groupsTable.tableName,
"externalId",a)};c.prototype.getGroupsForSync=function(){return this.getAllFromIndexStore(this.dbSchema.groupsTable.tableName,"isSyncNeeded",1)};c.prototype.addPerson=function(a){return this.addEntity(a,this.dbSchema.peopleTable.tableName)};c.prototype.updatePerson=function(a,b){return this.updateEntity(this.dbSchema.peopleTable.tableName,a,b)};c.prototype.addOrUpdatePerson=function(a,b,c){return this.addOrUpdateEntity(this.dbSchema.peopleTable.tableName,a,b,c)};c.prototype.getPeopleForSync=function(){return this.getAllFromIndexStore(this.dbSchema.peopleTable.tableName,
"isSyncNeeded",1)};c.prototype.getPeopleForGroup=function(a){return this.getAllFromIndexStore(this.dbSchema.peopleTable.tableName,"groupId",a)};c.prototype.getPerson=function(a){return this.getOneFromIndexStore(this.dbSchema.peopleTable.tableName,"externalId",a)};c.prototype.addTransaction=function(a){return this.addEntity(a,this.dbSchema.transactionsTable.tableName)};c.prototype.updateTransaction=function(a,b){return this.updateEntity(this.dbSchema.transactionsTable.tableName,a,b)};c.prototype.addOrUpdateTransaction=
function(a,b,c){return this.addOrUpdateEntity(this.dbSchema.transactionsTable.tableName,a,b,c)};c.prototype.getTransaction=function(a){return this.getOneFromIndexStore(this.dbSchema.transactionsTable.tableName,"externalId",a)};c.prototype.getTransactions=function(a){return this.getFromIndexStore(this.dbSchema.transactionsTable.tableName,"groupId",a)};c.prototype.getTransactionsForSync=function(){return this.getAllFromIndexStore(this.dbSchema.transactionsTable.tableName,"isSyncNeeded",1)};return c}();spreaders.sync.synchroniser=function(){var c=function(a,b){this.storage=a;this.apiService=b;this.transactionsAddedToJson=this.peopleAddedToJson=this.groupsAddedToJson=!1;this.syncedGroups=[];this.syncedPeople=[];this.syncedTransactions=[]};c.prototype.syncEntities=function(){var a=this;return $jscomp.executeAsyncGenerator(function(){function b(b,d,m){for(;;)switch(c){case 0:return a.apiUpdateJsonModel={groups:[],people:[],transactions:[]},c=1,{value:a.storage.getGroupsForSync(),done:!1};case 1:if(1!=
b){c=2;break}c=-1;throw m;case 2:return h=l=d,c=3,{value:a.storage.getPeopleForSync(),done:!1};case 3:if(1!=b){c=4;break}c=-1;throw m;case 4:return g=k=d,c=5,{value:a.storage.getTransactionsForSync(),done:!1};case 5:if(1!=b){c=6;break}c=-1;throw m;case 6:return e=f=d,a.apiUpdateJsonModel.groups=a.createGroupsJson(h),a.apiUpdateJsonModel.people=a.createPeopleJson(g),a.apiUpdateJsonModel.transactions=a.createTransactionsJson(e),c=-1,{value:a.makeRequest(),done:!0};default:return{value:void 0,done:!0}}}
var c=0,e,f,g,k,h,l,n={next:function(a){return b(0,a,void 0)},throw:function(a){return b(1,void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();n[Symbol.iterator]=function(){return this};return n}())};c.prototype.createGroupsJson=function(a){groupsJson=[];for(var b=0;b<a.length;b++)groupsJson.push({id:a[b].externalId,name:a[b].name,isDeleted:a[b].isDeleted,createdOn:a[b].createdOn,updatedOn:a[b].updatedOn}),this.syncedGroups.push(a[b]);return groupsJson};
c.prototype.createPeopleJson=function(a){peopleJson=[];for(var b=0;b<a.length;b++)peopleJson.push({id:a[b].externalId,name:a[b].name,colour:a[b].colour,isDeleted:a[b].isDeleted,groupId:a[b].groupId,createdOn:a[b].createdOn,updatedOn:a[b].updatedOn}),this.syncedPeople.push(a[b]);return peopleJson};c.prototype.createTransactionsJson=function(a){transactionJson=[];for(var b=0;b<a.length;b++)transactionJson.push({id:a[b].externalId,amount:a[b].amount,description:a[b].description,createdOn:a[b].createdOn,
updatedOn:a[b].updatedOn,payerId:a[b].payer,payees:a[b].payees,isDeleted:a[b].isDeleted,groupId:a[b].groupId}),this.syncedTransactions.push(a[b]);return transactionJson};c.prototype.makeRequest=function(){var a=this;return $jscomp.executeAsyncGenerator(function(){function b(b,d,e){for(;;)switch(c){case 0:return c=-1,{value:new Promise(function(b,c){a.isSyncNeeded()?a.apiService.syncWithFetch(a.apiUpdateJsonModel).then(function(){a.setEntitiesToSynced();b()}):b()}),done:!0};default:return{value:void 0,
done:!0}}}var c=0,e={next:function(a){return b(0,a,void 0)},throw:function(a){return b(1,void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();e[Symbol.iterator]=function(){return this};return e}())};c.prototype.isSyncNeeded=function(){return 0<this.apiUpdateJsonModel.groups.length||0<this.apiUpdateJsonModel.people.length||0<this.apiUpdateJsonModel.transactions.length?!0:!1};c.prototype.setEntitiesToSynced=function(){this.processResponseEntities(this.syncedGroups,
this.storage.getGroup.bind(this.storage),this.storage.updateGroup.bind(this.storage),this.mapEntity);this.processResponseEntities(this.syncedPeople,this.storage.getPerson.bind(this.storage),this.storage.updatePerson.bind(this.storage),this.mapEntity);this.processResponseEntities(this.syncedTransactions,this.storage.getTransaction.bind(this.storage),this.storage.updateTransaction.bind(this.storage),this.mapEntity)};c.prototype.mapEntity=function(a,b){a.isSyncNeeded=0;return a};c.prototype.processResponseEntities=
function(a,b,c,e){for(var d=0;d<a.length;d++)this.processResponseEntity(a[d],b,c,e)};c.prototype.processResponseEntity=function(a,b,c,e){b(a.externalId).then(function(b){b=e(b,a);c(b,0)})};c.prototype.mapGroup=function(a,b){a||(a=new spreaders.model.group);a.externalId=b.id;a.name=b.name;a.createdOn=b.createdOn;a.updatedOn=b.updatedOn;a.isDeleted=0;b.isDeleted&&(a.isDeleted=1);a.isSyncNeeded=0;return a};c.prototype.mapPerson=function(a,b){a||(a=new spreaders.model.person);a.externalId=b.id;a.groupId=
b.groupId;a.name=b.name;a.colour=b.colour;a.createdOn=b.createdOn;a.updatedOn=b.updatedOn;a.isDeleted=0;b.isDeleted&&(a.isDeleted=1);a.isSyncNeeded=0;return a};c.prototype.mapTransaction=function(a,b){a||(a=new spreaders.model.transaction);a.externalId=b.id;a.groupId=b.groupId;a.payees=b.payees;a.payer=b.payerId;a.amount=b.amount;a.description=b.description;a.createdOn=b.createdOn;a.updatedOn=b.updatedOn;a.isDeleted=0;b.isDeleted&&(a.isDeleted=1);a.createdOn=b.createdOn;a.updatedOn=b.updatedOn;a.isSyncNeeded=
0;return a};c.prototype.checkForGroupUpdates=function(a,b){this.apiService.getGroup(a,this.UpdateGroup.bind(this),b)};c.prototype.UpdateGroup=function(a){var b=this;return new Promise(function(c,e){a||e("no group infomation passed in");e=[];var d=b.storage.addOrUpdateGroup(a.group,b.mapGroup,b.isGroupIdentical);e.push(d);for(d=0;d<a.people.length;d++){var g=b.storage.addOrUpdatePerson(a.people[d],b.mapPerson,b.isPersonIdentical);e.push(g)}for(d=0;d<a.transactions.length;d++)g=b.storage.addOrUpdateTransaction(a.transactions[d],
b.mapTransaction,b.isTransactionIdentical.bind(b)),e.push(g);Promise.all(e).then(function(a){a=a.includes(!0);c(a)},function(){}.bind(b))})};c.prototype.isGroupIdentical=function(a,b){return a&&a.name==b.name&&a.isDeleted==b.isDeleted?!0:!1};c.prototype.isPersonIdentical=function(a,b){return a&&a.name==b.name&&a.colour==b.colour&&a.isDeleted==b.isDeleted?!0:!1};c.prototype.isTransactionIdentical=function(a,b){return a&&this.areArraysEqual(a.payees,b.payees)&&a.payer==b.payerId&&a.amount==b.amount&&
a.description==b.description&&a.isDeleted==b.isDeleted?!0:!1};c.prototype.areArraysEqual=function(a,b){if(!a&&!b)return!0;if(!a||!b||a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(!b[c].includes(a[c]))return!1;return!0};c.prototype.isServiceWorkerAvailable=function(){return"serviceWorker"in navigator};c.prototype.startServiceWorker=function(){this.isServiceWorkerAvailable()&&navigator.serviceWorker.register("/serviceWorker.js").then(function(a){}).catch(function(a){})};c.prototype.syncWithServer=
function(){this.isServiceWorkerAvailable()&&navigator.serviceWorker.ready.then(function(a){a.sync.register("sync-updated-entities")})};c.prototype.getUpdatesForGroup=function(a){this.isServiceWorkerAvailable()&&navigator.serviceWorker.ready.then(function(b){b.sync.register("sync-group-"+a)})};return c}();spreaders.observer=function(){var c=function(){this.handlers=[]};c.prototype={subscribe:function(a,b,c){this.handlers.push({type:a,fn:b,context:c})},fire:function(a,b){this.handlers.forEach(function(c){c.type==a&&c.fn.call(c.context,b)})}};return c}();
