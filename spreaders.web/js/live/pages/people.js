spreaders.pages.people=function(){var a=function(a,c,d,e,f,g){var b=this;this.group;this.pageContext=a;this.urlService=c;this.apiService=d;this.storage=e;this.observer=f;this.synchroniser=g;this.peopleContainer=document.getElementsByClassName("peopleContainer")[0];this.addPersonContainer=document.getElementsByClassName("addPerson")[0];this.populateBackButton();a=this.pageContext.getCurrentGroupId();this.storage.getGroup(a).then(function(a){b.group=a;b.createAddPeopleForm();b.getAndPopulatePeople()});
this.observer.subscribe("personCreated",this.handlePersonCreated,this);this.observer.subscribe("personDeleted",this.handlePersonDeleted,this);this.synchroniser.startServiceWorker()};a.prototype.populateBackButton=function(){document.getElementsByClassName("backButton")[0].href=this.urlService.getTransactionsPage(this.pageContext.getCurrentGroupId())};a.prototype.handlePersonCreated=function(){this.synchroniser.syncWithServer();this.getAndPopulatePeople()};a.prototype.handlePersonDeleted=function(){this.synchroniser.syncWithServer();
this.getAndPopulatePeople()};a.prototype.getAndPopulatePeople=function(){var a=this;this.peopleContainer.innerHTML="";this.storage.getPeopleForGroup(this.group.externalId).then(function(c){a.populatePeople(c)})};a.prototype.populatePeople=function(a){a.forEach(function(a){0==a.isDeleted&&new spreaders.view.editablePerson(a,this.peopleContainer,this.storage,this.observer,this.urlService,this.pageContext)},this)};a.prototype.createAddPeopleForm=function(){new spreaders.view.addPerson(this.group,this.addPersonContainer,
this.storage,this.observer)};return a}();var storage=new spreaders.storage;storage.connect().then(function(a){a=new spreaders.urlService;var b=new spreaders.pageContext(a),c=new spreaders.observer,d=new spreaders.apiService,e=new spreaders.sync.synchroniser(storage,d);new spreaders.pages.people(b,a,d,storage,c,e)});
