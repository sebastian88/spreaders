spreaders.pages.transaction=function(){var a=function(b,a,c,d,f){var e=this;this.pageContext=b;this.urlService=a;this.storage=c;this.observer=d;this.synchroniser=f;this.isPayerRadiosRendered=this.isPayeeCheckboxesRendered=!1;this.currentGroup;this.storage.getGroup(this.pageContext.getCurrentGroupId()).then(function(b){e.populateForm(b)});this.observer.subscribe("payeeCheckboxesRendered",this.payeeCheckboxesRendered,this);this.observer.subscribe("payerRadiosRendered",this.payerRadiosRendered,this);
this.synchroniser.startServiceWorker()};a.prototype.populateForm=function(b){this.currentGroup=b;this.radiosContainer=document.getElementsByClassName("payerRadios")[0];this.payerRadios=new spreaders.view.payerRadio(this.currentGroup,this.radiosContainer,this.storage,this.observer);this.checkboxsContainer=document.getElementsByClassName("payeeCheckboxs")[0];this.payeeCheckboxes=new spreaders.view.payeeCheckboxes(this.currentGroup,this.checkboxsContainer,this.storage,this.observer);this.amountInput=
document.getElementsByName("amount")[0];this.amountInputError=document.getElementsByClassName("error_amount")[0];this.descriptionInput=document.getElementsByName("description")[0];this.submitButton=document.getElementsByClassName("submit")[0];this.addSubmitEvent()};a.prototype.payeeCheckboxesRendered=function(){this.isPayeeCheckboxesRendered=!0;this.addTransactionBeingEdited()};a.prototype.payerRadiosRendered=function(){this.isPayerRadiosRendered=!0;this.addTransactionBeingEdited()};a.prototype.addTransactionBeingEdited=
function(){var b=this;this.isPayeeCheckboxesRendered&&this.isPayerRadiosRendered&&(this.transactionBeingEditedId=this.pageContext.getCurrentTransaction(),this.isGuid(this.transactionBeingEditedId)&&this.storage.getTransaction(this.transactionBeingEditedId).then(function(a){b.addTransactionBeingEditedCallback(a)}))};a.prototype.addTransactionBeingEditedCallback=function(b){this.transactionBeingEdited=b;this.payerRadios.addSelectedValue(this.transactionBeingEdited.payer);this.payeeCheckboxes.addSelectedValues(this.transactionBeingEdited.payees);
this.amountInput.value=this.transactionBeingEdited.amount;this.descriptionInput.value=this.transactionBeingEdited.description;this.submitButton.innerHTML="update"};a.prototype.addSubmitEvent=function(){this.submitButton.addEventListener("click",this.processSubmit.bind(this))};a.prototype.processSubmit=function(b){b.preventDefault();this.hideAllErrors();this.formIsValid()?this.saveTransactionAndRedirect():this.displayErrors()};a.prototype.hideAllErrors=function(){errorElements=document.getElementsByClassName("error");
for(var b=0;b<errorElements.length;b++)errorElements[b].style.display="none"};a.prototype.formIsValid=function(){return this.payerRadios.isValid()&&this.payeeCheckboxes.isValid()&&""!==this.amountInput.value};a.prototype.saveTransactionAndRedirect=function(){var b=this.payerRadios.getValues()[0],a=this.payeeCheckboxes.getValues(),c=parseFloat(this.amountInput.value).toFixed(2),d=this.descriptionInput.value;this.isGuid(this.transactionBeingEditedId)?(this.transactionBeingEdited.payer=b,this.transactionBeingEdited.payees=
a,this.transactionBeingEdited.amount=c,this.transactionBeingEdited.description=d,this.storage.updateTransaction(this.transactionBeingEdited,!0)):(b=new spreaders.model.transaction(this.currentGroup,b,a,c,d),this.storage.addTransaction(b));this.synchroniser.syncWithServer();window.location.href=this.urlService.getTransactionsPage(this.pageContext.getCurrentGroupId())};a.prototype.displayErrors=function(){this.payerRadios.displayError();this.payeeCheckboxes.displayError();this.amountInput.value||(this.amountInputError.style.display=
"block")};a.prototype.isGuid=function(a){return/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(a)};return a}();var storage=new spreaders.storage;storage.connect().then(function(a){a=new spreaders.urlService;var b=new spreaders.pageContext(a),e=new spreaders.observer,c=new spreaders.apiService;c=new spreaders.sync.synchroniser(storage,c);new spreaders.pages.transaction(b,a,storage,e,c)});
